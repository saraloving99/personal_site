---
title: "Projects"
output:
  html_document:
    toc: true
    toc_float: true
    collapsed: false
    number_sections: false
    toc_depth: 1
    #code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Florida and Georgia Ballot Rejections by County, 2020

This project was completed as part of my work as a Junior Fellow in the University of Florida Political Science Department during the Fall 2020 semester. The goal of this project was to determine if different demographic groups were more likely to have their mail ballots rejected during the 2020 election in Florida and Georgia.

```{r fl map, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
library(tidyverse)
library(plyr)
library(dplyr)
library(sp)
library(raster)
library(rgdal)
library(sf)
library(dplyr)
library(spData)
library(tmap)
library(eeptools)

flrejections<-read.csv("/Users/saraloving/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/Florida Map/AP_EN_output_11022020.csv")
floctober<-read.csv("/Users/saraloving/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/Florida Map/AP_EN_Oct_output_11022020.csv")
flrejections$CountyName<-revalue(flrejections$CountyCode, c("ALA"="ALACHUA", "BAK"="BAKER", "BAY"="BAY", "BRA"="BRADFORD", "BRE"="BREVARD", "BRO"="BROWARD", "CAL"="CALHOUN", "CHA"="CHARLOTTE", "CIT"="CITRUS", "CLA"="CLAY", "CLL"="COLLIER", "CLM"="COLUMBIA", "DAD"="MIAMI-DADE", "DIX"="DIXIE", "DUV"="DUVAL", "ESC"="ESCAMBIA",
                                                            "FLA"="FLAGLER", "FRA"="FRANKLIN", "GAD"="GADSDEN", "GIL"="GILCHRIST", "GLA"="GLADES", "GUL"="GULF", "HEN"="HENDRY", "HER"="HERNANDO", "HIL"="HILLSBOROUGH", "HOL"="HOLMES", "IND"="INDIAN RIVER", "JAC"="JACKSON", "JEF"="JEFFERSON", "LAK"="LAKE", "LEE"="LEE", "LEO"="LEON",
                                                            "LEV"="LEVY", "MAD"="MADISON", "MAN"="MANATEE", "MON"="MONROE", "MRN"="MARION", "MRT"="MARTIN", "NAS"="NASSAU", "OKA"="OKALOOSA", "OKE"="OKEECHOBEE", "ORA"="ORANGE", "OSC"="OSCEOLA", "PAL"="PALM BEACH", "PAS"="PASCO", "PIN"="PINELLAS", "POL"="POLK", "PUT"="PUTNAM",
                                                            "SAN"="SANTA ROSA", "SAR"="SARASOTA", "SEM"="SEMINOLE", "STJ"="ST. JOHNS", "STL"="ST. LUCIE", "SUM"='SUMTER', "SUW"="SUWANNEE", "TAY"="TAYLOR", "UNI"="UNION", "VOL"="VOLUSIA", "WAK"="WAKULLA", "WAL"="WALTON", "WAS"="WASHINGTON"))
floctober$CountyName<-revalue(floctober$CountyCode, c("ALA"="ALACHUA", "BAK"="BAKER", "BAY"="BAY", "BRA"="BRADFORD", "BRE"="BREVARD", "BRO"="BROWARD", "CAL"="CALHOUN", "CHA"="CHARLOTTE", "CIT"="CITRUS", "CLA"="CLAY", "CLL"="COLLIER", "CLM"="COLUMBIA", "DAD"="MIAMI-DADE", "DIX"="DIXIE", "DUV"="DUVAL", "ESC"="ESCAMBIA",
                                                            "FLA"="FLAGLER", "FRA"="FRANKLIN", "GAD"="GADSDEN", "GIL"="GILCHRIST", "GLA"="GLADES", "GUL"="GULF", "HEN"="HENDRY", "HER"="HERNANDO", "HIL"="HILLSBOROUGH", "HOL"="HOLMES", "IND"="INDIAN RIVER", "JAC"="JACKSON", "JEF"="JEFFERSON", "LAK"="LAKE", "LEE"="LEE", "LEO"="LEON",
                                                            "LEV"="LEVY", "MAD"="MADISON", "MAN"="MANATEE", "MON"="MONROE", "MRN"="MARION", "MRT"="MARTIN", "NAS"="NASSAU", "OKA"="OKALOOSA", "OKE"="OKEECHOBEE", "ORA"="ORANGE", "OSC"="OSCEOLA", "PAL"="PALM BEACH", "PAS"="PASCO", "PIN"="PINELLAS", "POL"="POLK", "PUT"="PUTNAM",
                                                            "SAN"="SANTA ROSA", "SAR"="SARASOTA", "SEM"="SEMINOLE", "STJ"="ST. JOHNS", "STL"="ST. LUCIE", "SUM"='SUMTER', "SUW"="SUWANNEE", "TAY"="TAYLOR", "UNI"="UNION", "VOL"="VOLUSIA", "WAK"="WAKULLA", "WAL"="WALTON", "WAS"="WASHINGTON"))
floctober$Race<-revalue(as.character(floctober$Race), c("1"="Other", "2"="Other", "3"="Black", "4"="Hispanic", "5"="White", "6"="Other", "7"="Other", "8"="Other", "9"="Other"))
library(lubridate)
floctober$BirthDate<-as.Date(floctober$BirthDate, format = "%m/%d/%y", origin="1900-01-01")
floctober$BirthDate<-as.Date(ifelse(floctober$BirthDate > "2003-01-01", format(floctober$BirthDate, "19%y-%m-%d"), format(floctober$BirthDate)))
floctober$Age <- age_calc(floctober$BirthDate, as.Date('2020-11-03'), units = "years")
floctober$Age <- round(floctober$Age, digits = 0)
floctober <- plyr::mutate(floctober, Agecat2 = case_when(Age >= 18  & Age <= 23 ~ '18-23',
                                                                     Age >= 24  & Age <= 29 ~ '24-29',
                                                                     Age >= 30  & Age <= 44 ~ '30-44',
                                                                     Age >= 45  & Age <= 64 ~ '45-64',
                                                                     Age >= 65 ~ '65-105'))
floctober <- dplyr::select(floctober, -c("BirthDate", "Age"))
flrejections <- dplyr::select(flrejections, -c("reg.year"))
flrejections <- rbind(flrejections, floctober)
flrejections <- dplyr::select(flrejections, -c(NameSuffix, DaytimeAreaCode,DaytimePhoneNumber,EmailAddress))
flrejections$ResidenceState="Florida"
library(stringr)
flrejections$ResidenceZipcode <- substr(flrejections$ResidenceZipcode, 0, 5)
flrejections$location <- paste0(flrejections$ResidenceAddressLine1, ", ", flrejections$ResidenceCity, ", FL ", flrejections$ResidenceZipcode)

library(sp)
library(raster)
library(rgdal)
flcounty <- readOGR("/Users/saraloving/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/Florida Map/florida_shapefile.shp", verbose=FALSE)
setClass("num.with.commas")
setAs("character", "num.with.commas", function(from) as.numeric(gsub(",", "", from) ) )
flcounty$NAME = toupper(flcounty$NAME)
fltotals<-read.csv("/Users/saraloving/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/Florida Map/FL VBM Totals.csv")
fltotals$COUNTYNAME<-revalue(fltotals$COUNTYID, c("ALA"="ALACHUA", "BAK"="BAKER", "BAY"="BAY", "BRA"="BRADFORD", "BRE"="BREVARD", "BRO"="BROWARD", "CAL"="CALHOUN", "CHA"="CHARLOTTE", "CIT"="CITRUS", "CLA"="CLAY", "CLL"="COLLIER", "CLM"="COLUMBIA", "DAD"="MIAMI-DADE", "DIX"="DIXIE", "DUV"="DUVAL", "ESC"="ESCAMBIA",
                                                      "FLA"="FLAGLER", "FRA"="FRANKLIN", "GAD"="GADSDEN", "GIL"="GILCHRIST", "GLA"="GLADES", "GUL"="GULF", "HEN"="HENDRY", "HER"="HERNANDO", "HIL"="HILLSBOROUGH", "HOL"="HOLMES", "IND"="INDIAN RIVER", "JAC"="JACKSON", "JEF"="JEFFERSON", "LAK"="LAKE", "LEE"="LEE", "LEO"="LEON",
                                                      "LEV"="LEVY", "MAD"="MADISON", "MAN"="MANATEE", "MON"="MONROE", "MRN"="MARION", "MRT"="MARTIN", "NAS"="NASSAU", "OKA"="OKALOOSA", "OKE"="OKEECHOBEE", "ORA"="ORANGE", "OSC"="OSCEOLA", "PAL"="PALM BEACH", "PAS"="PASCO", "PIN"="PINELLAS", "POL"="POLK", "PUT"="PUTNAM",
                                                      "SAN"="SANTA ROSA", "SAR"="SARASOTA", "SEM"="SEMINOLE", "STJ"="ST. JOHNS", "STL"="ST. LUCIE", "SUM"='SUMTER', "SUW"="SUWANNEE", "TAY"="TAYLOR", "UNI"="UNION", "VOL"="VOLUSIA", "WAK"="WAKULLA", "WAL"="WALTON", "WAS"="WASHINGTON"))
fltotals<-mutate(fltotals, Proportion=(E+N) / (E+N+V))
fltotals<-mutate(fltotals, "Percent Rejected"=((E+N) / (E+N+V))*100)
#Race:
fltest <- flrejections %>% group_by(CountyName, Race) %>% dplyr::summarise(n = dplyr::n())
fltest<-left_join(fltest, fltotals, by = c("CountyName"="COUNTYNAME"))
fltest<-mutate(fltest, RejectedRace=n / (E+N))
fltest<-mutate(fltest, RejectedRacePercent=(n / (E+N))*100)
fltest2<-left_join(fltotals, fltest, by=c("COUNTYNAME"="CountyName"))
fltest2<-dplyr::select(fltest2, -c(COUNTYID.x, COUNTYID.y, E.y, N.y, V.y, Proportion.y, "Percent Rejected.y"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "Race", "n", "RaceProp","Percent of Rejected Ballots by Race")
names(fltest2)<-names
fltest3<-spread(fltest2, Race, "Percent of Rejected Ballots by Race", fill = NA, convert = FALSE)
fltest3<-dplyr::select(fltest3, -c("RaceProp"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "n", "Black Percent of Total Rejected", "Hispanic Percent of Total Rejected", "Other Percent of Total Rejected", "White Percent of Total Rejected", "No Race Specified")
names(fltest3)<-names
coalesce_by_column <- function(fltest3) {
  return(coalesce(fltest3[1], fltest3[2], fltest3[3], fltest3[4], fltest3[5]))
}
fltest4<-fltest3 %>%
  group_by(COUNTYNAME) %>%
  summarise_all(coalesce_by_column)
#Age:
fltest5 <- flrejections %>% group_by(CountyName, Agecat2) %>% dplyr::summarise(n = dplyr::n())
fltest5<-left_join(fltest5, fltotals, by = c("CountyName"="COUNTYNAME"))
fltest5<-mutate(fltest5, RejectedAge=n / (E+N))
fltest5<-mutate(fltest5, RejectedAgePercent=(n / (E+N))*100)
fltest6<-left_join(fltotals, fltest5, by=c("COUNTYNAME"="CountyName"))
fltest6<-dplyr::select(fltest6, -c(COUNTYID.x, COUNTYID.y, E.y, N.y, V.y, Proportion.y, "Percent Rejected.y"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "Age Category", "n", "AgeProp","Percent of Rejected Ballots by Age")
names(fltest6)<-names
fltest7<-spread(fltest6, "Age Category", "Percent of Rejected Ballots by Age", fill = NA, convert = FALSE)
fltest7<-dplyr::select(fltest7, -c("AgeProp"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "n", "18 to 23 Percent of Total Rejected", "24 to 29 Percent of Total Rejected", "30 to 44 Percent of Total Rejected", "45 to 64 Percent of Total Rejected", "65 to 105 Percent of Total Rejected", "Other", "No Age Specified Percent of Total Rejected")
names(fltest7)<-names
fltest7<-dplyr::select(fltest7, -c("Other"))
coalesce_by_column <- function(fltest7) {
  return(coalesce(fltest7[1], fltest7[2], fltest7[3], fltest7[4], fltest7[5], fltest7[6]))
}
fltest8<-fltest7 %>%
  group_by(COUNTYNAME) %>%
  summarise_all(coalesce_by_column)
#Gender:
fltest9 <- flrejections %>% group_by(CountyName, Gender) %>% dplyr::summarise(n = dplyr::n())
fltest9<-left_join(fltest9, fltotals, by = c("CountyName"="COUNTYNAME"))
fltest9<-mutate(fltest9, RejectedGender=n / (E+N))
fltest9<-mutate(fltest9, RejectedGenderPercent=(n / (E+N))*100)
fltest10<-left_join(fltotals, fltest9, by=c("COUNTYNAME"="CountyName"))
fltest10<-dplyr::select(fltest10, -c(COUNTYID.x, COUNTYID.y, E.y, N.y, V.y, Proportion.y, "Percent Rejected.y"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "Gender", "n", "GenderProp","Percent of Rejected Ballots by Gender")
names(fltest10)<-names
fltest11<-spread(fltest10, "Gender", "Percent of Rejected Ballots by Gender", fill = NA, convert = FALSE)
fltest11<-dplyr::select(fltest11, -c("GenderProp"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "n", "Female Percent of Total Rejected", "Male Percent of Total Rejected", "Other Gender Percent of Total Rejected", "No Gender Specified Percent of Total Rejected")
names(fltest11)<-names
coalesce_by_column <- function(fltest11) {
  return(coalesce(fltest11[1], fltest11[2], fltest11[3], fltest11[4]))
}
fltest12<-fltest11 %>%
  group_by(COUNTYNAME) %>%
  summarise_all(coalesce_by_column)
#Party:
fltest13 <- flrejections %>% group_by(CountyName, PartyAffiliation) %>% dplyr::summarise(n = dplyr::n())
fltest13<-left_join(fltest13, fltotals, by = c("CountyName"="COUNTYNAME"))
fltest13<-mutate(fltest13, RejectedParty=n / (E+N))
fltest13<-mutate(fltest13, RejectedPartyPercent=(n / (E+N))*100)
fltest14<-left_join(fltotals, fltest13, by=c("COUNTYNAME"="CountyName"))
fltest14<-dplyr::select(fltest14, -c(COUNTYID.x, COUNTYID.y, E.y, N.y, V.y, Proportion.y, "Percent Rejected.y"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "Party", "n", "PartyProp","Percent of Rejected Ballots by Party")
names(fltest14)<-names
fltest15<-spread(fltest14, "Party", "Percent of Rejected Ballots by Party", fill = NA, convert = FALSE)
fltest15<-dplyr::select(fltest15, -c("PartyProp"))
names<-c("E", "N", "V", "COUNTYNAME", "Proportion", "Percent Rejected", "n", "Democrat Percent of Total Rejected", "No Party Affiliation Percent of Total Rejected", "Third Party Percent of Total Rejected", "Republican Percent of Total Rejected", "No Party Specified Percent of Total Rejected")
names(fltest15)<-names
coalesce_by_column <- function(fltest15) {
  return(coalesce(fltest15[1], fltest15[2], fltest15[3], fltest15[4], fltest15[5]))
}
fltest15<-fltest15[ -c(13) ]
fltest16<-fltest15 %>%
  group_by(COUNTYNAME) %>%
  summarise_all(coalesce_by_column)
#Merge:
fltest16<-dplyr::select(fltest16, -c(2:6))
fltest12<-dplyr::select(fltest12, -c(2:6))
fltest8<-dplyr::select(fltest8, -c(2:6))
fltest17<-left_join(fltest4, fltest8, by=c("COUNTYNAME"="COUNTYNAME"))
fltest18<-left_join(fltest17, fltest12, by=c("COUNTYNAME"="COUNTYNAME"))
fltest19<-left_join(fltest18, fltest16, by=c("COUNTYNAME"="COUNTYNAME"))
fltest20<-data.frame(fltest19$COUNTYNAME, fltest19$E, fltest19$N, fltest19$V, fltest19$Proportion, round(fltest19[6:30], 1))
names<-c("COUNTYNAME", "Voter-Caused Errors", "Missing Signature", "V", "Proportion", "Percent Rejected", "n.x", "Black Percent of Total Rejected", "Hispanic Percent of Total Rejected", "Other Percent of Total Rejected", "White Percent of Total Rejected", "No Race Specified","n.y","18 to 23 Percent of Total Rejected","24 to 29 Percent of Total Rejected","30 to 44 Percent of Total Rejected","45 to 64 Percent of Total Rejected","65 to 105 Percent of Total Rejected","No Age Specified Percent of Total Rejected","n.x.x","Female Percent of Total Rejected","Male Percent of Total Rejected","Other Gender Percent of Total Rejected","No Gender Specified Percent of Total Rejected","n.y.y","Democrat Percent of Total Rejected","No Party Affiliation Percent of Total Rejected","Third Party Percent of Total Rejected","Republican Percent of Total Rejected","No Party Specified Percent of Total Rejected")
names(fltest20)<-names
flcounty <- merge(flcounty, fltest20, by.x ="NAME", by.y = "COUNTYNAME")
library(RColorBrewer)
my.palette <- brewer.pal(n = 7, name = "Purples")
library(sf)
library(raster)
library(dplyr)
library(spData)
library(tmap)
tmap_mode("view")
tm_shape(flcounty) + tm_polygons(col = "Percent Rejected", palette = my.palette, popup.vars=c("Percent Rejected", "Voter-Caused Errors", "Missing Signature", "Black Percent of Total Rejected", "Hispanic Percent of Total Rejected", "Other Percent of Total Rejected", "White Percent of Total Rejected", "No Race Specified", 
                                                                                              "18 to 23 Percent of Total Rejected","24 to 29 Percent of Total Rejected","30 to 44 Percent of Total Rejected","45 to 64 Percent of Total Rejected","65 to 105 Percent of Total Rejected","No Age Specified Percent of Total Rejected",
                                                                                              "Female Percent of Total Rejected","Male Percent of Total Rejected","Other Gender Percent of Total Rejected","No Gender Specified Percent of Total Rejected",
                                                                                              "Democrat Percent of Total Rejected","No Party Affiliation Percent of Total Rejected","Third Party Percent of Total Rejected","Republican Percent of Total Rejected","No Party Specified Percent of Total Rejected")) + tm_layout(main.title = "Percent Rejected by County", title.size = 0.5, legend.outside=T)
```

*Note: Counties with "missing" data currently have no ballots to be cured, meaning that they have 0 rejected.

```{r ga map, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
#GA 2020 General Election VBM Rejections
library(tidyverse)
library(lubridate)
library(eeptools)
gavbmtotal<-read_csv("~/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/Georgia VBM Rejections General Election 2020/Rejected with Voter File.csv")

#Totals
garejected<-filter(gavbmtotal, Ballot_Status=="R")
gatotals<-table(gavbmtotal$County)
gatotals<-data.frame(gatotals)
garejects <- garejected %>% group_by(County) %>% dplyr::summarise(n = dplyr::n())
gatotals<-left_join(gatotals, garejects, by = c("Var1"="County"))
gatotals<-mutate(gatotals, "Proportion Rejected"=n / Freq, "Percent Rejected"=(n / Freq)*100)
gatotals<-dplyr::select(gatotals, -c(2:3))

#Race:
gavbmrace<-table(gavbmtotal$County, gavbmtotal$RACE_DESC) 
gavbmrace<-data.frame(gavbmrace)
gavbmrace<-gavbmrace %>% group_by(Var1)
gatest <- garejected %>% group_by(County, RACE_DESC) %>% dplyr::summarise(n = dplyr::n())
gatest<-left_join(gavbmrace, gatest, by = c("Var1"="County", "Var2"="RACE_DESC"))
gatest<-left_join(gatest, gatotals, by=c("Var1"="Var1"))
gatest<-mutate(gatest, rej_rate=n / Freq)
gatest<-mutate(gatest, rej_perc=(n / Freq)*100)
names<-c("County", "Race", "Total", "Number Rejected", "Proportion Rejected", "Percent Rejected", "Proportion Rejected by Race", "Percent Rejected by Race")
names(gatest)<-names
gatest<-dplyr::select(gatest, -c(5,7))
gatest2<-spread(gatest, "Race", "Percent Rejected by Race", fill = NA, convert = FALSE)
coalesce_by_column <- function(gatest2) {
  return(coalesce(gatest2[1], gatest2[2], gatest2[3], gatest2[4], gatest2[5], gatest2[6], gatest2[7]))
}
gatest3<-gatest2 %>%
  group_by(County) %>%
  summarise_all(coalesce_by_column)

#Age:
gavbmage<-table(gavbmtotal$County, gavbmtotal$agegroup) 
gavbmage<-data.frame(gavbmage)
gavbmage<-gavbmage %>% group_by(Var1)
gatest4 <- garejected %>% group_by(County, agegroup) %>% dplyr::summarise(n = dplyr::n())
gatest4<-left_join(gavbmage, gatest4, by = c("Var1"="County", "Var2"="agegroup"))
gatest4<-left_join(gatest4, gatotals, by=c("Var1"="Var1"))
gatest4<-mutate(gatest4, rej_rate=n / Freq)
gatest4<-mutate(gatest4, rej_perc=(n / Freq)*100)
names<-c("County", "Age Group", "Total", "Number Rejected", "Proportion Rejected", "Percent Rejected", "Proportion Rejected by Age", "Percent Rejected by Age")
names(gatest4)<-names
gatest4<-dplyr::select(gatest4, -c(5,7))
gatest5<-spread(gatest4, "Age Group", "Percent Rejected by Age", fill = NA, convert = FALSE)
coalesce_by_column <- function(gatest5) {
  return(coalesce(gatest5[1], gatest5[2], gatest5[3], gatest5[4], gatest5[5], gatest5[6]))
}
gatest6<-gatest5 %>%
  group_by(County) %>%
  summarise_all(coalesce_by_column)

#Gender:
gavbmgender<-table(gavbmtotal$County, gavbmtotal$GENDER) 
gavbmgender<-data.frame(gavbmgender)
gavbmgender<-gavbmgender %>% group_by(Var1)
gatest7 <- garejected %>% group_by(County, GENDER) %>% dplyr::summarise(n = dplyr::n())
gatest7<-left_join(gavbmgender, gatest7, by = c("Var1"="County", "Var2"="GENDER"))
gatest7<-left_join(gatest7, gatotals, by=c("Var1"="Var1"))
gatest7<-mutate(gatest7, rej_rate=n / Freq)
gatest7<-mutate(gatest7, rej_perc=(n / Freq)*100)
names<-c("County", "Gender", "Total", "Number Rejected", "Proportion Rejected", "Percent Rejected", "Proportion Rejected by Gender", "Percent Rejected by Gender")
names(gatest7)<-names
gatest7<-dplyr::select(gatest7, -c(5,7))
gatest8<-spread(gatest7, "Gender", "Percent Rejected by Gender", fill = NA, convert = FALSE)
coalesce_by_column <- function(gatest8) {
  return(coalesce(gatest8[1], gatest8[2], gatest8[3]))
}
gatest9<-gatest8 %>%
  group_by(County) %>%
  summarise_all(coalesce_by_column)
names<-c("County", "Total", "Number Rejected", "Percent Rejected", "Female", "Male", "Other Gender")
names(gatest9)<-names

#Merge:
gatest9<-dplyr::select(gatest9, -c(2:4))
gatest6<-dplyr::select(gatest6, -c(2:4))
gatest10<-left_join(gatest6, gatest9, by=c("County"="County"))
gatest11<-left_join(gatest10, gatest3, by=c("County"="County"))
gatest12<-data.frame(gatest11$County, round(gatest11[2:10], 2), round(gatest11[13:20], 2))
names<-c("County", "18 to 24 Rejection Rate", "25 to 34 Rejection Rate", "35 to 44 Rejection Rate", "45 to 55 Rejection Rate", "56 to 65 Rejection Rate", "66 and Older Rejection Rate", "Female Rejection Rate", "Male Rejection Rate", "Other Gender Rejection Rate", "Percent Rejected", "American Indian or Alaskan Native Rejection Rate", "Asian or Pacific Islander Rejection Rate", "Black Rejection Rate", "Hispanic Rejection Rate", "Other Race Rejection Rate", "Race Unknown Rejection Rate", "White Rejection Rate")
names(gatest12)<-names
library(sp)
library(raster)
library(rgdal)
gacounty <- readOGR("~/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/Georgia VBM Rejections General Election 2020/georgia_shapefile.shp", verbose=FALSE)
setClass("num.with.commas")
setAs("character", "num.with.commas", function(from) as.numeric(gsub(",", "", from) ) )
gacounty$NAME = toupper(gacounty$NAME)
gacounty <- merge(gacounty, gatest12, by.x ="NAME", by.y = "County")
library(RColorBrewer)
my.palette <- brewer.pal(n = 7, name = "Purples")
library(sf)
library(dplyr)
library(spData)
library(tmap)
tmap_mode("view")
tm_shape(gacounty) + tm_polygons(col = "Percent Rejected", palette = my.palette, popup.vars=c("Percent Rejected","American Indian or Alaskan Native Rejection Rate", "Asian or Pacific Islander Rejection Rate", "Black Rejection Rate", "Hispanic Rejection Rate", "Other Race Rejection Rate", "Race Unknown Rejection Rate", "White Rejection Rate",
                                                                                              "18 to 24 Rejection Rate", "25 to 34 Rejection Rate", "35 to 44 Rejection Rate", "45 to 55 Rejection Rate", "56 to 65 Rejection Rate", "66 and Older Rejection Rate", 
                                                                                              "Female Rejection Rate", "Male Rejection Rate", "Other Gender Rejection Rate"))
```


# Profiling Late Registrants in North Carolina and Florida

This project was completed for the course Election Data Science at UF, which I took during the Fall 2019 semester.

## Introduction
Recent academic research concerning the timing of voter registration and turnout (Shino and Smith, 2018) has demonstrated that voters who register to vote near an election are more likely to vote in that election. Still undetermined, however, is what motivates U.S. citizens to register to vote. One prominent theory is that people who register to vote around election time do so because they see the election, or the key issues being debated, as important. This relates to the cost-benefit analysis of voting behavior: when citizens turn out to vote, they see the benefits of voting as outweighing the time and resources required to vote. Are these voters more likely to register to a political party than those registering at other times due to an increased interest in the topics at stake? The goal of this project is to determine how the number of registrants who register with a political party affiliation varies over an election cycle. The hypothesis is that those who register to vote near an election date are more likely to choose a party affiliation than those who register at other times. A second hypothesis is that younger registrants will be less likely to proclaim a party affiliation than older registrants.

## Data 

##### Florida
The Florida voter file is public information under the law and accessible by request of the Florida Division of Elections. The deadline to register to vote in an upcoming election is 29 days prior to the election date. However, due to the impact of Hurricane Matthew in 2016, the registration deadline was moved from October 10th to October 18th. Florida also has closed primaries, meaning that in order to vote in a party's primary election, a voter must be registered under that party's affiliation. This will be important to note when examining party registration over a calendar year, as a decrease in the number of unaffiliated voters registering before a primary is to be expected.

##### North Carolina
North Carolina has a free, accessible voter file that is updated often on its elections website. The deadline to register to vote in an election in North Carolina is 25 days prior to the election date. This state was also affected by Hurricane Matthew, and in 2016, some counties had their registration deadline extended from October 14th to the 19th. North Carolina has semi-closed primaries: if a voter is registered as unaffiliated with a party, he or she may choose which primary to vote in (but may only choose one). Finally, it is important to note that North Carolina allows same-day registration during their early voting period, which usually occurs throughout a few weeks prior to Election Day.

## Setup
By the end of my project, I had to load in the following packages, excluding the packages needed for GIS data (which I'll get to later):  
```{r setup profile, eval = F, echo = T, results = 'hide', warning = FALSE, message = FALSE}
library(tidyverse)
library(plyr)
library(dplyr)
library(lubridate)
library(eeptools)
library(tibbletime)
library(grid)
library(gridExtra)
```
I then loaded in my data files and altered the variables to fit my analysis; for example, by making sure the dates were in a consistent format, creating new variables such as "month" and "age group," and factoring some variables:
```{r load, echo = T, eval = F, results = 'hide'}
ncvoter <- read.csv("/Users/saraloving/Desktop/Sara's Folder/UF Year 2/Fall 2019/POS4931/POS4931 Project/ncvoterfile2019.csv")
ncvoter <- ncvoter %>%
  mutate(registr_dt = ymd(registr_dt)) %>%
  group_by(month = floor_date(registr_dt, "month")) %>%
  mutate(party_cd = revalue(party_cd, c("CST" = "OTH", "GRE" = "OTH", "LIB" = "OTH")),
         party_cd = factor(ncvoter$party_cd, levels = c("OTH", "DEM", "REP", "UNA"))) %>%
  filter(birth_age >= 18, birth_age <= 100,
         voter_status_reason_desc != c("DECEASED"))
labs <- c(paste(seq(18, 81, by = 8), seq(18 + 8 - 1, 82-1, by = 8), sep = "-"), paste(82, "+", sep = ""))
ncvoter <- ncvoter %>% 
  mutate(age_group = cut(birth_age, 
                         breaks = c(seq(18, 82, by = 8), Inf), 
                         labels = labs, 
                         right = FALSE))

flvoter <- read.csv("/Users/saraloving/Desktop/Sara's Folder/UF Year 2/Fall 2019/POS4931/POS4931 Project/floridavoterfile2019.csv")
flvoter <- flvoter %>%
  mutate(reg_date = ymd(reg_date)) %>% 
  group_by(month = floor_date(reg_date, "month")) %>%
  mutate(party_cd = revalue(party_cd, c("CPF" = "OTH", "ECO" = "OTH", "GRE" = "OTH", "IND" = "OTH", "LPF" = "OTH", "PSL" = "OTH", "REF" = "OTH")),
         party_cd = factor(party_cd, levels = c("OTH", "DEM", "REP", "NPA"))) %>%
  filter(birth_age >= 18, birth_age <= 100)
labs <- c(paste(seq(18, 81, by = 8), seq(18 + 8 - 1, 82-1, by = 8), sep = "-"), paste(82, "+", sep = ""))
flvoter <- flvoter %>%
  mutate(age_group = cut(birth_age, 
                         breaks = c(seq(18, 82, by = 8), Inf), 
                         labels = labs, 
                         right = FALSE))

colors <- c("blanchedalmond", "royalblue2","firebrick2","darkorchid3")
```

## Voter Registration by Month
I first wanted to test if party registration proportions vary according to month. It is already well-documented that during the month of an election deadline, the number of voters registering increases greatly. For example, here's the voter registration by month in 2016 and 2018 in Florida and North Carolina:

```{r voterregmonth, eval = F}
flvoter2016 <- filter(flvoter, reg_date >= as.Date("2016-01-01"), reg_date <= as.Date("2016-12-31"))
flvotermonth2016 <- ggplot(data = flvoter2016) + 
  geom_bar(aes(x = month), stat = "count") + 
  labs(title = "Voter Registration by Month", 
       subtitle = "Florida, 2016", 
       x = "Month", 
       y = "Voters Registered")

ncvoter2016 <- filter(ncvoter, registr_dt >= as.Date("2016-01-01"), registr_dt <= as.Date("2016-12-31"))
ncvotermonth2016 <- ggplot(data = ncvoter2016) + 
  geom_bar(aes(x = month), stat = "count") + 
  labs(title = "Voter Registration by Month", 
       subtitle = "North Carolina, 2016", 
       x = "Month", 
       y = "Voters Registered")

flvoter2018 <- filter(flvoter, reg_date >= as.Date("2018-01-01"), reg_date <= as.Date("2018-12-31"))
flvotermonth2018 <- ggplot(data = flvoter2018) + 
  geom_bar(aes(x = month), stat = "count") + 
  labs(title = "Voter Registration by Month", 
       subtitle = "Florida, 2018", 
       x = "Month", 
       y = "Voters Registered")

ncvoter2018 <- filter(ncvoter, registr_dt >= as.Date("2018-01-01"), registr_dt <= as.Date("2018-12-31"))
ncvotermonth2018 <- ggplot(data = ncvoter2018) + 
  geom_bar(aes(x = month), stat = "count") + 
  labs(title = "Voter Registration by Month", 
       subtitle = "North Carolina, 2018", 
       x = "Month", 
       y = "Voters Registered")

grid.arrange(flvotermonth2016, ncvotermonth2016, flvotermonth2018, ncvotermonth2018, nrow = 2, ncol = 2)
```  

```{r, echo = F, fig.height=8, fig.width=8, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image1.png")
```

As can be seen, the number of new registrations spikes in the months before primary and general elections. Next, I created fill charts displaying the proportion of new registrants that belonged to each party (DEM stands for Democrat, REP stands for Republican, NPA/UNA stands for No Party Affiliation/Unaffiliated, and OTH means the voter registered for a party that was not one of the other three):

```{r partyregmonth, eval = F}
ncpartyregmonth2016 <- ggplot(data = ncvoter2016) + 
  geom_bar(mapping = aes(x = month, fill = party_cd), position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Month", 
       subtitle = "North Carolina, 2016", 
       x = "Month", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

flpartyregmonth2016 <- ggplot(data = flvoter2016) + 
  geom_bar(mapping = aes(x = month, fill = party_cd), position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Month", 
       subtitle = "Florida, 2016", 
       x = "Month", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

ncpartyregmonth2018 <- ggplot(data = ncvoter2018) + 
  geom_bar(mapping = aes(x = month, fill = party_cd), position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Month", 
       subtitle = "North Carolina, 2018", 
       x = "Month", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

flpartyregmonth2018 <- ggplot(data = flvoter2018) + 
  geom_bar(mapping = aes(x = month, fill = party_cd), position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Month", 
       subtitle = "Florida, 2018", 
       x = "Month", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

grid.arrange(flpartyregmonth2016, ncpartyregmonth2016, flpartyregmonth2018, ncpartyregmonth2018, nrow = 2, ncol = 2)
```

```{r, echo = F, fig.height=8, fig.width=8, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image2.png")
```

Since Florida has closed primary elections, it makes sense that the proportion of voters registering as unaffiliated with a party decreases during the month of the primary election registration deadline (February in 2016 and July in 2018). In North Carolina, however, we see these unaffiliated decreases during both of the actual election months in 2016 (March and November), and in the general election month in 2018. Could it be possible that partisan registration increases during the one-stop early voting period in North Carolina, rather than before the actual registration deadline?

## Voter Registration by Day
After noticing this discrepancy, I decided to map out party registration by day in Fall 2016 and Fall 2018. Even though I only noticed the drop in unaffiliated registrants in North Carolina, I did this in Florida as well in case any other patterns were apparent. In the graphs below, the first line marks the day of the registration deadline and the second line marks the election date.
```{r voterregday, eval = F}
ncvoter2016election <- filter(ncvoter, registr_dt >= as.Date("2016-09-13"), registr_dt <= as.Date("2016-11-22"))
ncvoter2016day <- ggplot(data = ncvoter2016election) + 
  geom_bar(aes(x = registr_dt), stat = "count") + 
  labs(title = "Voter Registration by Day", 
       subtitle = "North Carolina, Fall 2016", 
       x = "Date", 
       y = "Voters Registered") + 
  geom_vline(xintercept = as.Date("2016-10-14"), linetype = "dashed", color = "red") + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "purple")

flvoter2016election <- filter(flvoter, reg_date >= as.Date("2016-09-13"), reg_date <= as.Date("2016-11-22"))
flvoter2016day <- ggplot(data = flvoter2016election) + 
  geom_bar(aes(x = reg_date), stat = "count") + 
  labs(title = "Voter Registration by Day", 
       subtitle = "Florida, Fall 2016", 
       x = "Date", 
       y = "Voters Registered") + 
  geom_vline(xintercept = as.Date("2016-10-18"), linetype = "dashed", color = "red") + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "purple")

ncvoter2018election <- filter(ncvoter, registr_dt >= as.Date("2018-09-11"), registr_dt <= as.Date("2018-11-20"))
ncvoter2018day <- ggplot(data = ncvoter2018election) + 
  geom_bar(aes(x = registr_dt), stat = "count") + 
  labs(title = "Voter Registration by Day", 
       subtitle = "North Carolina, Fall 2018", 
       x = "Date", 
       y = "Voters Registered") + 
  geom_vline(xintercept = as.Date("2018-10-12"), linetype = "dashed", color = "red") + 
  geom_vline(xintercept = as.Date("2018-11-06"), linetype = "dashed", color = "purple")

flvoter2018election <- filter(flvoter, reg_date >= as.Date("2018-09-11"), reg_date <= as.Date("2018-11-20"))
flvoter2018day <- ggplot(data = flvoter2018election) + 
  geom_bar(aes(x = reg_date), stat = "count") + 
  labs(title = "Voter Registration by Day", 
       subtitle = "Florida, Fall 2018", 
       x = "Date", 
       y = "Voters Registered") + 
  geom_vline(xintercept = as.Date("2018-10-09"), linetype = "dashed", color = "red") + 
  geom_vline(xintercept = as.Date("2018-11-06"), linetype = "dashed", color = "purple")

grid.arrange(flvoter2016day, ncvoter2016day, flvoter2018day, ncvoter2018day, nrow = 2, ncol = 2)
```

```{r, echo = F, fig.height=8, fig.width=8, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image3.png")
```

As can be seen in the graphs of voter registration by day, new registration spikes occurred on the day of the registration deadline as well as on Election Day. This corresponds to the idea that election-related stimuli encourage people to register to vote. (Note: The unmarked peak in registration in Florida in 2016 was likely because Florida moved its registration deadline due to Hurricane Matthew).  

```{r partyregday, eval = F}
ncpartyregday2016 <- ggplot(data = ncvoter2016election) + 
  geom_bar(mapping = aes(x = registr_dt, fill = party_cd), binwidth = 1, position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Day", 
       subtitle = "North Carolina, Fall 2016", 
       x = "Day", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party")) + 
  geom_vline(xintercept = as.Date("2016-10-14"), linetype = "dashed", color = "black") + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "black")

flpartyregday2016 <- ggplot(data = flvoter2016election) + 
  geom_bar(mapping = aes(x = reg_date, fill = party_cd), binwidth = 1, position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Day", 
       subtitle = "Florida, Fall 2016", 
       x = "Day", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party")) + 
  geom_vline(xintercept = as.Date("2016-10-18"), linetype = "dashed", color = "black") + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "black")

ncpartyregday2018 <- ggplot(data = ncvoter2018election) + 
  geom_bar(mapping = aes(x = registr_dt, fill = party_cd), binwidth = 1, position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Day", 
       subtitle = "North Carolina, Fall 2018", 
       x = "Day", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party")) + 
  geom_vline(xintercept = as.Date("2018-10-12"), linetype = "dashed", color = "black") + 
  geom_vline(xintercept = as.Date("2018-11-06"), linetype = "dashed", color = "black")

flpartyregday2018 <- ggplot(data = flvoter2018election) + 
  geom_bar(mapping = aes(x = reg_date, fill = party_cd), binwidth = 1, position = "fill") + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Day", 
       subtitle = "Florida, Fall 2018", 
       x = "Day", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party")) + 
  geom_vline(xintercept = as.Date("2018-10-09"), linetype = "dashed", color = "black") + 
  geom_vline(xintercept = as.Date("2018-11-06"), linetype = "dashed", color = "black")

grid.arrange(flpartyregday2016, ncpartyregday2016, flpartyregday2018, ncpartyregday2018, nrow = 2, ncol = 2)
```

```{r, echo = F, fig.height=8, fig.width=8, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image4.png")
```

The party registration seems somewhat random in Florida, likely due to some days having a smaller number of registrations. However, in North Carolina, one can see that the proportion of people registering as unaffiliated drops around election time, particularly between the registration deadline and the election date. This is consistent with what was seen in the graphs of party registration by month and agrees with the idea that people who register at one-stop early voting could be more likely to affiliate with a political party.

## Age as a Factor in Party Affiliation
As voters age, their party ties grow stronger, even in states like North Carolina where one does not need to be affiliated with a party to vote in the primaries. I graphed age versus party affiliation in Florida and North Carolina to show this relationship:
```{r agegraph, eval = F}
ncage <- ggplot(data = ncvoter) + 
  geom_histogram(mapping = aes(x = birth_age, fill = party_cd), position = "fill", binwidth = 1) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Age", 
       subtitle = "2019 North Carolina Voter File", 
       x = "Age", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

flage <- ggplot(data = flvoter) + 
  geom_histogram(mapping = aes(x = birth_age, fill = party_cd), position = "fill", binwidth = 1) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Age", 
       subtitle = "2019 Florida Voter File", 
       x = "Age", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

grid.arrange(flage, ncage, ncol = 2)
```

```{r, echo = F, fig.height=4, fig.width=8, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image5.png")
```

Thus, it is necessary to group by age and reexamine the relationship between registration timing and party affiliation we saw above.

```{r regbyage, eval = F}
ncregage2016 <- ggplot(data = ncvoter2016election) + 
  geom_bar(aes(x = registr_dt), stat = "count") + 
  labs(title = "Voter Registration by Day, Grouped by Age", 
       subtitle = "North Carolina, Fall 2016", 
       x = "Date", 
       y = "Voters Registered") + 
  facet_wrap(~ age_group, ncol = 3) + 
  theme(axis.text.x = element_text(angle = 90)) + 
  geom_vline(xintercept = as.Date("2016-10-14"), linetype = "dashed", color = "red", size = 0.5) + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "purple", size = 0.5)

flregage2016 <- ggplot(data = flvoter2016election) + 
  geom_bar(aes(x = reg_date), stat = "count") + 
  labs(title = "Voter Registration by Day, Grouped by Age", 
       subtitle = "Florida, Fall 2016", 
       x = "Date", 
       y = "Voters Registered") + 
  facet_wrap(~ age_group, ncol = 3) + 
  theme(axis.text.x = element_text(angle = 90)) + 
  geom_vline(xintercept = as.Date("2016-10-18"), linetype = "dashed", color = "red", size = 0.5) + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "purple", size = 0.5)

grid.arrange(flregage2016, ncregage2016, ncol = 2)
```

```{r, echo = F, fig.height=6, fig.width=10, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image6.png")
```

As can be seen above, not only does the youngest age group make up the largest group of new registrants in 2016 in both Florida and North Carolina, but also the "peaks" on the registration deadline and on Election Day are more exaggerated in younger groups. Now, let's examine party registration by day, grouped by age:

```{r partybyage, eval = F}
ncpartyage2016 <- ggplot(data = ncvoter2016election) + 
  geom_histogram(mapping = aes(x = registr_dt, fill = party_cd), position = "fill", binwidth = 3) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Date", 
       subtitle = "North Carolina, Fall 2016", 
       x = "Date", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party")) + 
  facet_wrap(~ age_group, ncol = 3) + 
  theme(axis.text.x = element_text(angle = 90)) + 
  geom_vline(xintercept = as.Date("2016-10-14"), linetype = "dashed", color = "black", size = 0.5) + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "black", size = 0.5)

flpartyage2016 <- ggplot(data = flvoter2016election) + 
  geom_bar(mapping = aes(x = reg_date, fill = party_cd), position = "fill", binwidth = 3) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Date", 
       subtitle = "Florida, Fall 2016", 
       x = "Date", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party")) + 
  facet_wrap(~ age_group, ncol = 3) + 
  theme(axis.text.x = element_text(angle = 90)) + 
  geom_vline(xintercept = as.Date("2016-10-18"), linetype = "dashed", color = "black", size = 0.5) + 
  geom_vline(xintercept = as.Date("2016-11-08"), linetype = "dashed", color = "black", size = 0.5)

grid.arrange(flpartyage2016, ncpartyage2016, ncol = 2)
```

```{r, echo = F, fig.height=6, fig.width=10, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image7.png")
```

There doesn't seem to be any noticeable patterns here, other than that the dip in unaffiliated registration between the registration deadline and the election date in North Carolina is more pronounced in younger age groups. However, this is expected since the younger age groups have more observations than the older age groups.

## Age versus Party Affiliation in Election Years

After seeing a large number of young voters registering around election time, I wondered if the proportions of party registration by age of those registering during election years were different from the proportions across all times.

```{r partybyageyrs, eval = F}
ncage2016 <- ggplot(data = ncvoter2016) + 
  geom_histogram(mapping = aes(x = birth_age, fill = party_cd), position = "fill", binwidth = 1) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Age", 
       subtitle = "North Carolina, 2016", 
       x = "Age", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

flage2016 <- ggplot(data = flvoter2016) + 
  geom_histogram(mapping = aes(x = birth_age, fill = party_cd), position = "fill", binwidth = 1) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Age", 
       subtitle = "Florida, 2016", 
       x = "Age", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

ncage2018 <- ggplot(data = ncvoter2018) + 
  geom_histogram(mapping = aes(x = birth_age, fill = party_cd), position = "fill", binwidth = 1) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Age", 
       subtitle = "North Carolina, 2018", 
       x = "Age", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

flage2018 <- ggplot(data = flvoter2018) + 
  geom_histogram(mapping = aes(x = birth_age, fill = party_cd), position = "fill", binwidth = 1) + 
  scale_fill_manual(values = colors) + 
  labs(title = "Party Registration by Age", 
       subtitle = "Florida, 2018", 
       x = "Age", 
       y = "Proportion of Total") + 
  guides(fill = guide_legend(title = "Party"))

grid.arrange(flage2016, ncage2016, flage2018, ncage2018, nrow = 2, ncol = 2)
```

```{r, echo = F, fig.height=8, fig.width=8, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image8.png")
```

It does seem as though in 2016, especially in Florida, the slope of the proportion of unaffiliated voters versus age is slightly different. The youngest voters have lower numbers of unaffiliated voters than some older ages between 20 and 45. However, this data contains a voter's current age in 2019, so it could be that preregistered voters are less likely to register as unaffiliated than some older ages. I found much of the same in 2018, except now the ages are more accurate. An alternate explanation might be that voter registration drives on college campuses encourage students to register with a certain party affiliation, which I will now examine using GIS.

## Unaffiliated Voters by County in North Carolina

I decided to map the proportion of unaffiliated voters by county in North Carolina to see if the areas with lower proportions of unaffiliated voters were college towns. I also plotted the eight most populated universities in North Carolina for reference.

```{r ncmapsetup, eval = F}
library(sp)
library(raster)
library(rgdal)

nccounty <- readOGR("/Users/saraloving/Desktop/Sara's Folder/UF Year 3/Fall 2020/POS4911/POS4931 Project/tl_2019_37_county10.shp")

setClass("num.with.commas")
setAs("character", "num.with.commas", function(from) as.numeric(gsub(",", "", from) ) )

nccounty <- nccounty %>%
  mutate(NAME = toupper(NAME))
ncvoternpa <- ncvoter %>% 
  group_by(county_desc, party_cd) %>% 
  dplyr::summarise(n = dplyr::n())
ncvoternpa_new <- aggregate(x = ncvoternpa$n, by = list(ncvoternpa$county_desc), FUN = sum)

ncvoternpa_totals <- merge(ncvoternpa, ncvoternpa_new, by.x = "county_desc", by.y = "Group.1") %>% 
  mutate(Proportion = n / x)

ncvoternpacounty <- filter(ncvoternpa_totals, party_cd == "UNA")

nccounty <- merge(nccounty, ncvoternpacounty, by.x = "NAME", by.y = "county_desc")

library(RColorBrewer)
my.palette <- brewer.pal(n = 7, name = "Purples")
library(sf)
library(spData)
library(tmap)
nccolleges <- readOGR("nccolleges.shp")
```
```{r ncmap, eval = F}
tm_shape(nccounty) + 
  tm_polygons(col = "Proportion", palette = my.palette) + 
  tm_layout(main.title = "Proportion of Unaffiliated Voters by County", title.size = 0.5, legend.outside = T) +
  tm_shape(nccolleges) + 
  tm_symbols(col = "black", size = 0.3)
```

```{r, echo = F, fig.height=6, fig.width=10, fig.align='center'}
knitr::include_graphics("/Users/saraloving/Documents/GitHub/personal_site/Journal_files/figure-html/image9.png")
```

The counties that contain college campuses do not seem to have lower numbers of unaffiliated voters.

## Conclusion
Overall, it is clear that the proportion of unaffiliated registrants decreases between the registration deadline and the election date in North Carolina. This could instead be correlated with same-day registration during early voting. Furthermore, young people make up the largest proportion of registrants during election years. They also tend to be unaffiliated, but perhaps the youngest group of registrants (18-20 years old) have less unaffiliated voters than slightly older age groups. Some ideas for further analysis are:  
1. Do more registrants join the party of the winning presidential candidate after an election?  
2. Are the youngest registrants (i.e. college-aged voters) more likely than those aged 22-26 to choose a party affiliation when registering?

## Challenges
This was my first time working with large datasets in R and it took me some time to learn how to correctly import them and edit them to work with my analysis. In particular, I struggled in working with dates. Initially, R was reading the date columns in as factor variables, so I had to figure out how to parse these columns as date variables and filter them between certain boundaries.  
Furthermore, working with ages cause me some trouble. North Carolina includes a voter's age in its voter file, but Florida does not. I had to find a function (age_calc) to do this for me, and it did not work with the 13 million observations I had gathered into the Florida voter file. I ended up re-downloading the original Florida voter "folder" (which separates out voter files by county) and completing the age_calc operation in each smaller voter file, then consolidating them all again. 

## References

Shino, Enrijeta, and Daniel A. Smith. “Timing the Habit: Voter Registration and Turnout.” Electoral Studies, vol. 51, 2018, pp. 72–82., doi:10.1016/j.electstud.2017.10.005.